<!DOCTYPE html>
<html lang="ko">
<style>
body {
    margin: 0;
    padding: 0;
    
}

.bookcover {
    width: 80%;
    margin: auto;
    padding: 20px;
}


.profile-container, .content-container, .menu-container {
    display: flex;
    flex-direction: column;
    margin: 10px 0;
}

.profile-title, .content-title {
    margin: 10px 0px;
    font-size: 1.2em;
}


.profile-box, .content-box {
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 8px;
}

.profile-image-img {
    width: 200px;
    height: 200px;
    border-radius: 50%;
}

.profile-text, .profile-username, .profile-dropdown {
    margin: 10px 0;
}

.dropdown-button {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.dropdown-title {
    font-size: 1em;
}

.triangle-down {
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid black;
    margin-left: 10px;
}

.guestbook-scrollbox {
    max-height: 450px;
    overflow-y: auto;
}

.guestbook-box {
    border-bottom: 1px solid #ddd;
    padding: 10px 0;
}

.guestbook-title {
    font-weight: bold;
    margin-bottom: 5px;
}

.guestbook-contents {
    padding-left: 10px;
}

.guestbook-text {
    margin: 0;
}

.guestbook-writer {
    display: flex;
    align-items: center;
    margin-top: 10px;
}

#guestbookInput {
    flex: 1;
    padding: 0px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-right: 10px;
    height: 60px;
    margin-top: 10px;
}

.guestbook-button {
    padding: 10px 20px;
    background-color: #3b87ab;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    height: 55px;
}

.menu-button {
    display: flex;
    flex-direction: column;
}

.menu-button a {
    text-decoration: none;
    margin: 5px 0;
}
.guest-text{
    border-bottom: 1px solid #000;
}
.material-icons{
    cursor: pointer;
    border: none;
    background-color: transparent;
}
.guest-check-box{
    padding: 0px 10px;
}
.btn-primary{
    background-color: #3b87ab;
    cursor: pointer;
    border-radius: 4px;
    float: right;
    margin-right: 15px;
    color: #fff;
    border: none;
    width: 43px;
    height: 25px;
}
.btn-secondary{
    background-color: #3b87ab;
    cursor: pointer;
    border-radius: 4px;
    float: right;
    color: #fff;
    border: none;
    width: 43px;
    height: 25px;
}
.guest-text{
    font-size: 20px;
}
.edit-textarea {
    width: 100%;
    height: auto;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}


</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guestbookList</title>
    <link rel="stylesheet" href="/css/font.css">
    <link rel="stylesheet" href="/css/minihomepage.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
</head>
<body>
<th:block th:include="common/top"></th:block>
                                <div class="guestbook-scrollbox" id="guestbook-scrollbox">
                                    <div class="guest-text">방명록 ></div>
                                    <div class="guestbook-box" data-comment-no="1">
                                        <div class="guestbook-title">No. 1
                                            <span>이름</span>
                                           <button class="material-icons" data-url="#">home</button>
                                            <div class="guestbook-date">(2024.00.00)
                                                <button class="btn-secondary" onclick="confirmDeleteComment(this)">삭제</button>
                                                <button class="btn-primary" onclick="editComment(this)">수정</button>
                                            </div>
                                        </div>
                                        <div class="guestbook-contents">
                                            <div class="guestbook-text">
                                                <p>이 글귀 좋더라.. 읽어봐..<br><br><br>울ㅈ1않ㄱㅣ<br>아프ㅈ1않ㄱㅣ<br>씩씩ㅎrㄱㅣ<br>억ㅈㅣ로ㄹr도 웃ㄱㅣ<br>ㅌ1 ㄴㅐㅈㅣ 말ㄱㅣ<br>.<br>.<br>.<br>오늘도 괜찮은 듯<br>그렇ㄱㅔ ㅈ1ㄴㅐㄱㅣ</p>
                                                <textarea class="edit-textarea" style="display: none;"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="guestbook-box" data-comment-no="2">
                                        <div class="guestbook-title">No. 2
                                            <span>이름</span>
                                           <button class="material-icons" data-url="#">home</button>
                                            <div class="guestbook-date">(2024.00.00)
                                                <button class="btn-secondary" onclick="confirmDeleteComment(this)">삭제</button>
                                                <button class="btn-primary" onclick="editComment(this)">수정</button>
                                            </div>
                                        </div>
                                        <div class="guestbook-contents">
                                            <div class="guestbook-text">
                                                <p>너 내가 보내준 인소 봤냐 이 부분 개쩐다<br><br><br>"누구한테 문자하냐?"<br>"사랑하는 사람한테"<br><br><br>"나한테 문자를 왜 보내"</p>
                                                <textarea class="edit-textarea" style="display: none;"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="guestbook-box" data-comment-no="3">
                                        <div class="guestbook-title">No. 3
                                            <span>이름</span>
                                           <button class="material-icons" data-url="#">home</button>
                                            <div class="guestbook-date">(2024.00.00)
                                                <button class="btn-secondary" onclick="confirmDeleteComment(this)">삭제</button>
                                                <button class="btn-primary" onclick="editComment(this)">수정</button>
                                            </div>
                                        </div>
                                        <div class="guestbook-contents">
                                            <div class="guestbook-text">
                                                <p>야 내일 캔모아 갈래?</p>
                                                <textarea class="edit-textarea" style="display: none;"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="guestbook-box" data-comment-no="4">
                                        <div class="guestbook-title">No. 4
                                            <span>이름</span>
                                           <button class="material-icons" data-url="#">home</button>
                                            <div class="guestbook-date">(2024.00.00)
                                                <button class="btn-secondary" onclick="confirmDeleteComment(this)">삭제</button>
                                                <button class="btn-primary" onclick="editComment(this)">수정</button>
                                            </div>
                                        </div>
                                        <div class="guestbook-contents">
                                            <div class="guestbook-text">
                                                <p>나랑 찍은 사진은 왜 안 올려 ㅡ.ㅡ</p>
                                                <textarea class="edit-textarea" style="display: none;"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <form action="/guest/insertComment" method="post">
	                            <div class="guest-check-box">
	                                <input type="radio" name="guestBookType" id="anonymous" value="0">
	                                <label for="anonymous">익명</label>
	                                <input type="radio" name="guestBookType" id="nickname" value="1">
	                                <label for="nickname">닉네임</label>
	                            </div>
	                            <div class="guestbook-writer">
									                          
	                                <textarea id="guestbookInput" name="guestbookInput" placeholder="댓글을 입력하세요"></textarea>
	                               	
	                               <input type="hidden" name="memberNo" th:value="${friendMember.memberNo}">
	                               <input type="hidden" name="guestWriterNo" th:value="${session.member.memberNo}">
	                                <button class="guestbook-button" onclick="addGuestbookEntry()">전송</button> 
	                            </div>
                            </form>
                        <th:block th:include="common/bottom"></th:block>
    <script>
    // 날짜 가져오기
    function getCurrentDate() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hour = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        return `(${year}년${month}월${day}일${hour}시${minutes}분)`;
    }
    
    getNickName();
    function getNickName(){
    	const memberNickNameValue = $(".profile-username>span").text();
    	$(".nickName").val(memberNickNameValue);
    }
    
	//댓글추가
    function addGuestbookEntry() {
        const input = document.getElementById('guestbook-input');
        const text = input.value.trim();
        const identity = document.querySelector('input[name="guestbook-identity"]:checked');
        
        if (text === '') {
            alert('댓글 내용을 입력하세요.');
            return;
        }

        if (!identity) {
            alert('익명 또는 닉네임을 선택하세요.');
            return;
        }
        
        const memberNickName = $(".profile-username>span").text();
        

        const guestWriterNo = document.getElementById('guestWriterNo');
        const memberNo = document.getElementById('memberNo');

       
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/guest/insertComment';

        // 댓글 작성자 ID 입력 필드
        const writerInput = document.createElement('input');
        writerInput.type = 'hidden';
        writerInput.name = 'guestWriterNo';
        writerInput.value = 39;
        form.appendChild(writerInput);

        // 댓글 내용 입력 필드
        const contentInput = document.createElement('input');
        contentInput.type = 'hidden';
        contentInput.name = 'guestCommentContent';
        contentInput.value = text;
        form.appendChild(contentInput);

        // 회원 ID 입력 필드
        const memberInput = document.createElement('input');
        memberInput.type = 'hidden';
        memberInput.name = 'memberNo';
        memberInput.value = test22; 
        form.appendChild(memberInput);

        // 폼을 문서에 추가하고 제출
        document.body.appendChild(form);
        form.submit();
    }

    
    // 댓글 삭제 확인
    function confirmDeleteComment(button) {
        const guestbookBox = button.closest('.guestbook-box');
        const guestCommentNo = guestbookBox.dataset.commentNo;

        if (!guestCommentNo) {
            console.error('댓글 번호가 없습니다.');
            return;
        }

        if (confirm('정말로 이 댓글을 삭제하시겠습니까?')) {
            deleteComment(button);
        }
    }
    
 // 댓글 삭제
    function deleteComment(button) {
        const guestbookBox = button.closest('.guestbook-box');
        const guestCommentNo = guestbookBox.dataset.commentNo;

        if (!guestCommentNo) {
            console.error('댓글 번호가 없습니다.');
            return;
        }

        $.ajax({
            type: 'GET',
            url: `/guest/deleteComment?guestCommentNo=${guestCommentNo}`,
            success: function(response) {
                guestbookBox.remove();
            },
            error: function(error) {
                alert('댓글 삭제 중 오류가 발생했습니다.');
            }
        });
    }

    // 댓글 수정
    function editComment(button) {
        const guestbookBox = button.closest('.guestbook-box');
        const textElement = guestbookBox.querySelector('.guestbook-text p');
        const textarea = guestbookBox.querySelector('.edit-textarea');

        if (textarea.style.display === 'none') {
            textarea.value = textElement.innerText;
            textarea.style.display = 'block';
            textElement.style.display = 'none';
            button.textContent = '저장';
            button.setAttribute('onclick', 'saveComment(this)');
        }
    }

    // 댓글 저장
    function saveComment(button) {
        const guestbookBox = button.closest('.guestbook-box');
        const textarea = guestbookBox.querySelector('.edit-textarea');
        const textElement = guestbookBox.querySelector('.guestbook-text p');
        const newText = textarea.value.trim();

        if (newText === '') {
            alert('댓글 내용이 비어있습니다.');
            return;
        }

        const guestCommentNo = guestbookBox.dataset.commentNo;

        if (!guestCommentNo) {
            console.error('댓글 번호가 없습니다.');
            return;
        }

        const data = {
            guestCommentNo: guestCommentNo,
            guestCommentContent: newText
        };

        $.ajax({
            type: 'POST',
            url: '/guest/updateComment',
            data: JSON.stringify(data),
            contentType: 'application/json',
            success: function(response) {
                textElement.innerText = newText;
                textElement.style.display = 'block';
                textarea.style.display = 'none';
                button.textContent = '수정';
                button.setAttribute('onclick', 'editComment(this)');
            },
            error: function(error) {
                alert('댓글 수정 중 오류가 발생했습니다.');
            }
        });
    }

    // 댓글 엔터로 전송
    document.getElementById('guestbook-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            addGuestbookEntry();
        }
    });
    
    </script>
    
</body>
</html>